<p-card>
  <div class="header">
    <b>{{$header () ?? ($reading().date!.toISODate() | date: 'E, MMM d')}}</b>
    <small>Bible Reading</small>
  </div>
  <div class="readings">
    @for (chapter of $reading().reading; track $index) {
      @if (bibleReadingEngine.$bibleBooks().length > 0) {
        <a [href]="bibleReadingEngine.bibleReadingLinkURL(chapter)" target="_blank">
          @let passage = bibleReadingEngine.$bibleBooks()[chapter.bookId - 1].abbr +' '+ chapter.fromChapter +'-'+ chapter.toChapter;
          <p-chip>
            <i class="pi pi-book"></i>
            {{passage}}
            <i class="pi pi-link"></i>
          </p-chip>
        </a>
      }
    }
  </div>

  @if (userEngine.$signedInUser()) {
    @let
    progressPercentage = $progress()?.progress === 'PREPARING' ? Math.round(100 * 1 / 3) : $progress()?.progress === 'READING' ? Math.round(100 * 2 / 3) : $progress()?.progress === 'COMPLETE' ? Math.round(100 * 3 / 3) : Math.round(100 * 1 / 3);
    <div class="progress">
      <p-progress-bar [value]="progressPercentage"/>
      <p-button-group class="test">
        <p-button [outlined]="$progress()?.progress !== 'PREPARING' && $progress()" size="small"
                  (click)="bibleReadingEngine.updateProgress($reading().scheduleId, 0, $reading().day, 'PREPARING')">
          Preparing
        </p-button>
        <p-button [outlined]="$progress()?.progress !== 'READING'" size="small"
                  (click)="bibleReadingEngine.updateProgress($reading().scheduleId, 0, $reading().day, 'READING')">
          Reading
        </p-button>
        <p-button [outlined]="$progress()?.progress !== 'COMPLETE'" size="small"
                  (click)="bibleReadingEngine.updateProgress($reading().scheduleId, 0, $reading().day, 'COMPLETE')">
          Complete
        </p-button>
      </p-button-group>
    </div>


    <ng-template #footer>
        <p-button
          fluid
          icon="pi pi-trophy"
          label="Submit Gem"
          [disabled]="$progress()?.progress != 'COMPLETE'"
          (click)="gemsEngine.openNewGemDialog($reading())"></p-button>
<!--      <app-add-gem-dialog [($visible)]="$getDialogVisible" [$reading]="$reading()"></app-add-gem-dialog>-->
    </ng-template>
  }

</p-card>
